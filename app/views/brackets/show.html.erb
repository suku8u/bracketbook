<p id="notice"><%= notice %></p>

<p>
  <b>Name:</b>
  <%= @bracket.name %>
</p>

<h2>Teams</h2>
<ul id="teams">
  <% @bracket.teams.each do |team| %>
    <li>
      <%= team.name %>
    </li>
  <% end %>
</ul>

<h2>Matches</h2>
<table id="matches" border="1" padding="5">
  <tr>
    <th>Match</th>
    <th>Team 1 Name</th>
    <th>Team 2 Name</th>
    <th>Team 1 Score</th>
    <th>Team 2 Score</th>
    <th>Update Score</th>
  </tr>
  <% @matches.each_with_index do |m, i| %>
    <tr>
      <td><%= i+1 %></td>
      <td><%= m[:team1_name] %></td>
      <td><%= m[:team2_name] %></td>
      <td><%= m[:team1_score] %></td>
      <td><%= m[:team2_score] %></td>
      <td>
        <% if not m[:edit_path].blank? %>
          <%= link_to "edit", m[:edit_path] %>
        <% end %>
      </td>
    </tr>
  <% end %>
</table>
<% bracket_height = 20 %>
<% bracket_top_margin_offset = 10 %>
<% @matches_in_each_round.each_with_index do |num_matches, index| %>
  <% bracket_height = bracket_height * 2 %>
  <% bracket_top_margin_offset = bracket_top_margin_offset * 2 %>
  <div style="height:auto; width: 200px; float:left; margin-top:-<%= bracket_top_margin_offset %>px">
    <% num_matches.times do %>
      <% m = @matches.shift %>
      <div style="width:200px; height:<%= bracket_height %>px; position:relative;">
        <div style="position:absolute; bottom:0; left:20px;">
          <%= m[:team1_name] %> (<%= m[:team1_score] %>)
        </div>
      </div>
      <div style="width:200px; height:<%= bracket_height %>px; border:2px solid black; border-left:none; position:relative;">
        <div style="position:absolute; bottom:0; left:20px;">
          <%= m[:team2_name] %> (<%= m[:team2_score] %>)
        </div>
        <div style="position:absolute; top:0; right:20px;">
          <% if not m[:edit_path].blank? %>
            <%= link_to "edit", m[:edit_path] %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

  <% bracket_top_margin_offset = bracket_top_margin_offset * 2 %>
  <div style="height:auto; width:200px; float:left; border-bottom:2px solid black; position:relative; top:<%= bracket_top_margin_offset %>px; padding-left:20px;">
    <% m = @matches.shift %>
    <% if m[:team1_name] != "?" %>
      <%= m[:team1_name] %>
    <% elsif m[:team2_name] != "?" %>
      <%= m[:team2_name] %>
    <% else %>
      ?
    <% end %>
  </div>

<%= link_to 'Back', brackets_path %>
